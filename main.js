(()=>{"use strict";function e(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.removeAttribute("disabled")):(t.classList.add(n),t.setAttribute("disabled",""))}var t=document.querySelector(".profile__edit-button"),n=document.querySelector(".profile__add-button"),o=document.querySelector(".popup_profile"),r=document.querySelector(".popup_new-place"),c=document.querySelector(".popup_big-image"),u=document.querySelector("#card-template").content,i=document.querySelector(".cards-container"),a=r.querySelector(".popup__form"),l=o.querySelector(".popup__form"),s=l.querySelector('input[name="user-name"]'),d=l.querySelector('input[name="user-bio"]'),p=a.querySelector('input[name="place-name"]'),f=a.querySelector('input[name="place-link"]'),_=document.querySelector(".popup__big-img"),m=document.querySelector(".popup__img-description"),v=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),y=document.querySelectorAll(".popup"),b=document.querySelector(".profile__avatar"),S=document.querySelector(".popup_confirm"),q=S.querySelector(".popup__submit-button"),L=document.querySelector(".profile__btn-edit"),k=document.querySelector(".popup_new-avatar"),E=(k.querySelector(".popup__submit-button"),k.querySelector("form")),g=E.querySelector(".popup__input-field");function C(e){e.classList.add("popup_opened"),document.addEventListener("keydown",A)}function x(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",A)}function A(e){"Escape"===e.key&&x(document.querySelector(".popup_opened"))}function U(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status," ").concat(e.statusText))}function T(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";t.textContent=e?"Сохранение...":n}function w(e){e.classList.add("popup__submit-button_inactive"),e.setAttribute("disabled","")}var P={baseUrl:"https://nomoreparties.co/v1/plus-cohort-11",headers:{authorization:"ae0b9021-b91d-4516-99a3-d1f2660c87bd","Content-Type":"application/json"}};var D="";function B(e,t){var n=u.querySelector(".card").cloneNode(!0),o=n.querySelector(".card__image");o.src=e.link,o.alt=e.name,n.querySelector(".card__description").textContent=e.name,n.id=e._id;var r,i,a,l=n.querySelector(".card__like-button"),s=n.querySelector(".card__likes-count"),d=n.querySelector(".card__remove-button");return e.owner._id===t._id?d.addEventListener("click",(function(){C(S),D=n})):d.remove(),s.textContent=e.likes.length,r=e.likes,i=t._id,a=l,r.forEach((function(e){e._id!==i||a.classList.add("card__like-button_active")})),l.addEventListener("click",(function(){var t;l.classList.contains("card__like-button_active")?(t=e._id,fetch("".concat(P.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:P.headers}).then((function(e){return U(e)}))).then((function(e){s.textContent=e.likes.length,l.classList.toggle("card__like-button_active")})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(P.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:P.headers}).then((function(e){return U(e)}))}(e._id).then((function(e){s.textContent=e.likes.length,l.classList.toggle("card__like-button_active")})).catch((function(e){console.log(e)}))})),o.addEventListener("click",(function(){var t,n;t=e.name,n=e.link,_.src=n,_.alt=t,m.textContent=t,C(c)})),n}function N(e){i.prepend(e)}var O,j,J,H,z,M,F,G=[];Promise.all([fetch("".concat(P.baseUrl,"/users/me"),{headers:P.headers}).then((function(e){return U(e)})),fetch("".concat(P.baseUrl,"/cards"),{headers:P.headers}).then((function(e){return U(e)}))]).then((function(e){if(v.textContent=e[0].name,h.textContent=e[0].about,b.src=e[0].avatar,e[1].length>0)e[1].forEach((function(t){N(B(t,e[0]))}));else{var t=document.createElement("p");t.textContent="Нет карточек для отображения",document.querySelector(".cards-container").before(t)}return G=e[0]})).catch((function(e){console.log(e)})),t.addEventListener("click",(function(){s.value=v.textContent,d.value=h.textContent,C(o)})),n.addEventListener("click",(function(){C(r)})),l.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=o.querySelector(".popup__submit-button");T(!0,r),(t=s.value,n=d.value,fetch("".concat(P.baseUrl,"/users/me"),{method:"PATCH",headers:P.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return U(e)}))).then((function(e){!function(e,t){v.textContent=e,h.textContent=t}(s.value,d.value),x(o),w(r)})).catch((function(e){console.log(e)})).finally((function(){T(!1,r)}))})),a.addEventListener("submit",(function(e){var t,n,o;e.preventDefault(),t=G,n={name:p.value,link:f.value},T(!0,o=r.querySelector(".popup__submit-button")),function(e){return fetch("".concat(P.baseUrl,"/cards"),{method:"POST",headers:P.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return U(e)}))}(n).then((function(e){N(B(e,t)),x(r),w(o),a.reset()})).catch((function(e){console.log(e)})).finally((function(){T(!1,o,"Создать")}))})),L.addEventListener("click",(function(){C(k)})),y.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&x(e),t.target.classList.contains("popup__close-button")&&x(e)}))})),j=(O={formSelector:".popup__form",inputSelector:".popup__input-field",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__input-field_type_error",errorClass:"popup__input-error_active"}).formSelector,J=O.inputSelector,H=O.submitButtonSelector,z=O.inactiveButtonClass,M=O.inputErrorClass,F=O.errorClass,Array.from(document.querySelectorAll(j)).forEach((function(t){!function(t,n,o,r,c,u){var i=Array.from(t.querySelectorAll(n)),a=t.querySelector(o);e(i,a,r),i.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n,o){t.validity.valid?function(e,t,n,o){var r=e.querySelector("#".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector("#".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o)}(t,n,c,u),e(i,a,r)}))}))}(t,J,H,z,M,F)})),q.addEventListener("click",(function(){var e;(e=D.id,fetch("".concat(P.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:P.headers}).then((function(e){return U(e)}))).then((function(){D.remove(),x(S)})).catch((function(e){console.log(e)}))})),E.addEventListener("submit",(function(e){e.preventDefault();var t,n=k.querySelector(".popup__submit-button");T(!0,n),(t=g.value,fetch("".concat(P.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:P.headers,body:JSON.stringify({avatar:t})}).then((function(e){return U(e)}))).then((function(e){b.src=e.avatar,x(k),w(n),E.reset()})).catch((function(e){console.log(e)})).finally((function(){T(!1,n)}))}))})();