(()=>{"use strict";function t(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n),e.removeAttribute("disabled")):(e.classList.add(n),e.setAttribute("disabled",""))}var e=document.querySelector(".profile__edit-button"),n=document.querySelector(".profile__add-button"),o=document.querySelector(".popup_profile"),c=document.querySelector(".popup_new-place"),r=document.querySelector(".popup_big-image"),a=document.querySelector("#card-template").content,u=document.querySelector(".cards-container"),i=c.querySelector(".popup__form"),s=o.querySelector(".popup__form"),l=s.querySelector('input[name="user-name"]'),d=s.querySelector('input[name="user-bio"]'),p=i.querySelector('input[name="place-name"]'),f=i.querySelector('input[name="place-link"]'),m=document.querySelector(".popup__big-img"),_=document.querySelector(".popup__img-description"),h=document.querySelector(".profile__title"),v=document.querySelector(".profile__description"),y=document.querySelectorAll(".popup"),b=document.querySelector(".profile__avatar"),S=document.querySelector(".popup_confirm"),q=S.querySelector(".popup__submit-button"),E=document.querySelector(".profile__btn-edit"),k=document.querySelector(".popup_new-avatar"),x=(k.querySelector(".popup__submit-button"),k.querySelector("form")),L=x.querySelector(".popup__input-field");function C(t){t.classList.add("popup_opened"),document.addEventListener("keydown",T)}function w(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",T)}function T(t){"Escape"===t.key&&w(document.querySelector(".popup_opened"))}function g(t){var e=document.querySelector(".popup_opened").querySelector(".popup__submit-button");t?e.textContent="Сохранение...":e.closest(".popup_new-place")?e.textContent="Создать":e.textContent="Сохранить"}function j(t){var e=t.querySelector(".popup__submit-button");e.classList.add("popup__submit-button_inactive"),e.setAttribute("disabled","")}var P={baseUrl:"https://nomoreparties.co/v1/plus-cohort-11",headers:{authorization:"ae0b9021-b91d-4516-99a3-d1f2660c87bd","Content-Type":"application/json"}};var A="";function U(t,e){var n=a.querySelector(".card").cloneNode(!0),o=n.querySelector(".card__image");o.src=t.link,o.alt=t.name,n.querySelector(".card__description").textContent=t.name;var c,u,i,s=n.querySelector(".card__like-button"),l=n.querySelector(".card__likes-count"),d=n.querySelector(".card__remove-button");return t.owner._id===e._id?d.addEventListener("click",(function(){C(S),A=t._id,n.id="delete"})):d.remove(),n.querySelector(".card__likes-count").textContent=t.likes.length,c=t.likes,u=e._id,i=s,c.forEach((function(t){t._id!==u||i.classList.add("card__like-button_active")})),s.addEventListener("click",(function(){s.classList.toggle("card__like-button_active"),s.classList.contains("card__like-button_active")?function(t,e){fetch("".concat(P.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:P.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status," ").concat(t.statusText))})).then((function(t){e.textContent=t.likes.length})).catch((function(t){throw new Error("".concat(t.status," ").concat(t.statusText))}))}(t._id,l):function(t,e){fetch("".concat(P.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:P.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status," : ").concat(t.statusText))})).then((function(t){e.textContent=t.likes.length})).catch((function(t){throw new Error("".concat(t.status," ").concat(t.statusText))}))}(t._id,l)})),o.addEventListener("click",(function(){var e,n;e=t.name,n=t.link,m.src=n,m.alt=e,_.textContent=e,C(r)})),n}function D(t){u.prepend(t)}var B,N,O,J,H,z,M,F={};fetch("".concat(P.baseUrl,"/users/me"),{headers:P.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status," : ").concat(t.statusText))})).then((function(t){return t})).catch((function(t){throw new Error("".concat(t.status," ").concat(t.statusText))})).then((function(t){return h.textContent=t.name,v.textContent=t.about,b.src=t.avatar,F=t})),fetch("".concat(P.baseUrl,"/cards"),{headers:P.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status," : ").concat(t.statusText))})).then((function(t){return t})).catch((function(t){throw new Error("".concat(t.status," ").concat(t.statusText))})).then((function(t){if(t.length>0)t.forEach((function(t){D(U(t,F))}));else{var e=document.createElement("p");e.textContent="Нет карточек для отображения",document.querySelector(".cards-container").before(e)}})),e.addEventListener("click",(function(){l.value=h.textContent,d.value=v.textContent,C(o)})),n.addEventListener("click",(function(){C(c)})),s.addEventListener("submit",(function(t){var e,n;t.preventDefault(),e=l.value,n=d.value,h.textContent=e,v.textContent=n,function(t,e){fetch("".concat(P.baseUrl,"/users/me"),{method:"PATCH",headers:P.headers,body:JSON.stringify({name:t,about:e})}).then((function(t){return g(!0),t.ok?t.json():Promise.reject("Ошибка ".concat(t.status," : ").concat(t.statusText))})).catch((function(t){throw new Error("".concat(t.status," ").concat(t.statusText))})).finally((function(){g(!1)})).finally((function(){w(o)})).finally((function(){j(o)}))}(l.value,d.value)})),i.addEventListener("submit",(function(t){var e;t.preventDefault(),e=F,function(t,e){fetch("".concat(P.baseUrl,"/cards"),{method:"POST",headers:P.headers,body:JSON.stringify({name:t.name,link:t.link})}).then((function(t){return t.ok?(g(!0),t.json()):Promise.reject("Ошибка ".concat(t.status," : ").concat(t.statusText))})).then((function(t){D(U(t,e))})).catch((function(t){throw new Error("".concat(t.status," ").concat(t.statusText))})).finally((function(){g(!1)})).finally((function(){w(c)})).finally((function(){j(c)}))}({name:p.value,link:f.value},e),i.reset()})),E.addEventListener("click",(function(){C(k)})),y.forEach((function(t){t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_opened")&&w(t),e.target.classList.contains("popup__close-button")&&w(t)}))})),N=(B={formSelector:".popup__form",inputSelector:".popup__input-field",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__input-field_type_error",errorClass:"popup__input-error_active"}).formSelector,O=B.inputSelector,J=B.submitButtonSelector,H=B.inactiveButtonClass,z=B.inputErrorClass,M=B.errorClass,Array.from(document.querySelectorAll(N)).forEach((function(e){!function(e,n,o,c,r,a){var u=Array.from(e.querySelectorAll(n)),i=e.querySelector(o);t(u,i,c),u.forEach((function(n){n.addEventListener("input",(function(){!function(t,e,n,o){e.validity.valid?function(t,e,n,o){var c=t.querySelector("#".concat(e.id,"-error"));e.classList.remove(n),c.classList.remove(o),c.textContent=""}(t,e,n,o):function(t,e,n,o,c){var r=t.querySelector("#".concat(e.id,"-error"));e.classList.add(o),r.textContent=n,r.classList.add(c)}(t,e,e.validationMessage,n,o)}(e,n,r,a),t(u,i,c)}))}))}(e,O,J,H,z,M)})),q.addEventListener("click",(function(){var t;t=A,fetch("".concat(P.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:P.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status," : ").concat(t.statusText))})).catch((function(t){throw new Error("".concat(t.status," ").concat(t.statusText))})),w(S),document.querySelector("#delete").remove()})),x.addEventListener("submit",(function(t){var e;t.preventDefault(),e=L.value,fetch("".concat(P.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:P.headers,body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?(g(!0),t.json()):Promise.reject("Ошибка ".concat(t.status," : ").concat(t.statusText))})).then((function(t){b.src=t.avatar})).catch((function(t){throw new Error("".concat(t.status," ").concat(t.statusText))})).finally((function(){g(!1)})).finally((function(){w(k)})).finally((function(){j(k)})),x.reset()}))})();